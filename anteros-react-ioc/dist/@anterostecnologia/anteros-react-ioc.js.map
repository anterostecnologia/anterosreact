{"version":3,"file":"@anterostecnologia/anteros-react-ioc.js","mappings":"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","sources":["webpack://@anterostecnologia/anteros-react-ioc/webpack/universalModuleDefinition","webpack://@anterostecnologia/anteros-react-ioc/./src/container.ts","webpack://@anterostecnologia/anteros-react-ioc/./src/decorator.ts","webpack://@anterostecnologia/anteros-react-ioc/./src/define.ts","webpack://@anterostecnologia/anteros-react-ioc/./src/resolve.ts","webpack://@anterostecnologia/anteros-react-ioc/./src/symbol.ts","webpack://@anterostecnologia/anteros-react-ioc/./src/token.ts","webpack://@anterostecnologia/anteros-react-ioc/./src/wire.ts","webpack://@anterostecnologia/anteros-react-ioc/webpack/bootstrap","webpack://@anterostecnologia/anteros-react-ioc/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@anterostecnologia/anteros-react-ioc\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@anterostecnologia/anteros-react-ioc\"] = factory();\n\telse\n\t\troot[\"@anterostecnologia/anteros-react-ioc\"] = factory();\n})(typeof self !== 'undefined' ? self : this, () => {\nreturn ","import { getType, MaybeToken, stringifyToken } from \"./token\";\nimport { NOPLUGINS } from \"./symbol\";\n\ninterface Item<T> {\n  factory?: Factory<T>;\n  value?: Value<T>;\n  cache?: T;\n  singleton?: boolean;\n  plugins: Plugin<T>[];\n}\n\nexport type Plugin<Dependency = any, Target = any> = (\n  dependency: Dependency,\n  target: Target | undefined,\n  args: symbol[],\n  token: MaybeToken<Dependency>,\n  container: ContainerIoc\n) => void;\n\ninterface NewAble<T> {\n  new (...args: any[]): T;\n}\n\ntype Registry = Map<symbol, Item<any>>;\n\ntype Factory<T> = () => T;\ntype Value<T> = T;\n\nclass PluginOptions<T> {\n  constructor(protected _target: Item<T>) {}\n\n  withPlugin(plugin: Plugin<T>): PluginOptions<T> {\n    this._target.plugins.push(plugin);\n    return this;\n  }\n}\n\nclass Options<T> extends PluginOptions<T> {\n  inSingletonScope(): PluginOptions<T> {\n    this._target.singleton = true;\n    return this;\n  }\n}\n\nclass Bind<T> {\n  constructor(private _target: Item<T>) {}\n\n  to(object: NewAble<T>): Options<T> {\n    this._target.factory = () => new object();\n    return new Options<T>(this._target);\n  }\n\n  toFactory(factory: Factory<T>): Options<T> {\n    this._target.factory = factory;\n    return new Options<T>(this._target);\n  }\n\n  toValue(value: Value<T>): PluginOptions<T> {\n    if (typeof value === \"undefined\") {\n      throw new Error(\"Não é possível vincular um valor do tipo indefinido\");\n    }\n    this._target.value = value;\n    return new PluginOptions<T>(this._target);\n  }\n}\n\nexport class ContainerIoc {\n  private _registry: Registry = new Map<symbol, Item<any>>();\n  private _snapshots: Registry[] = [];\n  private _plugins: Plugin[] = [];\n\n  bind<T = never>(token: MaybeToken<T>): Bind<T> {\n    return new Bind<T>(this._create<T>(token));\n  }\n\n  rebind<T = never>(token: MaybeToken<T>): Bind<T> {\n    return this.remove(token).bind<T>(token);\n  }\n\n  remove(token: MaybeToken): ContainerIoc {\n    if (this._registry.get(getType(token)) === undefined) {\n      throw new Error(`${stringifyToken(token)} não existe no container.`);\n    }\n\n    this._registry.delete(getType(token));\n\n    return this;\n  }\n\n  get<T = never>(\n    token: MaybeToken<T>,\n    args: symbol[] = [],\n    target?: unknown\n  ): T {\n    const item = this._registry.get(getType(token));\n\n    if (item === undefined) {\n      throw new Error(`nada ligado a ${stringifyToken(token)}`);\n    }\n\n    const { factory, value, cache, singleton, plugins } = item;\n\n    const execPlugins = (item: T): T => {\n      if (args.indexOf(NOPLUGINS) !== -1) return item;\n\n      for (const plugin of this._plugins.concat(plugins)) {\n        plugin(item, target, args, token, this);\n      }\n\n      return item;\n    };\n\n    const cacheItem = (creator: () => T): T => {\n      if (singleton && typeof cache !== \"undefined\") return cache;\n      if (!singleton) return creator();\n      item.cache = creator();\n      return item.cache;\n    };\n\n    if (typeof value !== \"undefined\") return execPlugins(value);\n    if (typeof factory !== \"undefined\")\n      return execPlugins(cacheItem(() => factory()));\n\n    throw new Error(`Nada está vinculado a ${stringifyToken(token)}`);\n  }\n\n  addPlugin(plugin: Plugin): ContainerIoc {\n    this._plugins.push(plugin);\n    return this;\n  }\n\n  snapshot(): ContainerIoc {\n    this._snapshots.push(new Map(this._registry));\n    return this;\n  }\n\n  restore(): ContainerIoc {\n    this._registry = this._snapshots.pop() || this._registry;\n    return this;\n  }\n\n  private _create<T>(token: MaybeToken<T>): Item<T> {\n    if (this._registry.get(getType(token)) !== undefined) {\n      throw new Error(\n        `Objeto só pode ser vinculado uma vez: ${stringifyToken(token)}`\n      );\n    }\n\n    const item = { plugins: [] };\n    this._registry.set(getType(token), item);\n\n    return item;\n  }\n}\n","import { ContainerIoc } from \"./container\";\nimport { define } from \"./define\";\nimport { MaybeToken } from \"./token\";\n\nexport function createDecorator(container: ContainerIoc) {\n  return <T>(token: MaybeToken<T>, ...args: symbol[]) => {\n    return <Target extends { [key in Prop]: T }, Prop extends string>(\n      target: Target,\n      property: Prop\n    ): void => {\n      define(target, property, container, token, args);\n    };\n  };\n}\n","import { ContainerIoc } from \"./container\";\nimport { NOCACHE } from \"./symbol\";\nimport { MaybeToken } from \"./token\";\n\nexport function define<\n  T,\n  Target extends { [key in Prop]: T },\n  Prop extends string\n>(\n  target: Target,\n  property: Prop,\n  container: ContainerIoc,\n  token: MaybeToken<T>,\n  args: symbol[]\n) {\n  Object.defineProperty(target, property, {\n    get: function () {\n      const value = container.get<any>(token, args, this);\n      if (args.indexOf(NOCACHE) === -1) {\n        Object.defineProperty(this, property, {\n          value,\n          enumerable: true,\n        });\n      }\n      return value;\n    },\n    configurable: true,\n    enumerable: true,\n  });\n}\n","import { ContainerIoc } from \"./container\";\nimport { NOCACHE } from \"./symbol\";\nimport { MaybeToken } from \"./token\";\n\nexport function createResolve(container: ContainerIoc) {\n  return <T = never>(token: MaybeToken<T>, ...args: symbol[]) => {\n    let value: T;\n    return function (this: unknown): T {\n      if (args.indexOf(NOCACHE) !== -1 || value === undefined) {\n        value = container.get<T>(token, args, this);\n      }\n      return value;\n    };\n  };\n}\n","export const NOCACHE = Symbol(\"NOCACHE\");\nexport const NOPLUGINS = Symbol(\"NOPLUGINS\");\n","export function token<T>(name: string) {\n  return { type: Symbol(name) } as Token<T>;\n}\n\ndeclare const typeMarker: unique symbol;\n\nexport interface Token<T> {\n  type: symbol;\n  [typeMarker]: T;\n}\n\nexport type MaybeToken<T = unknown> = Token<T> | symbol;\n\nfunction isToken<T>(token: MaybeToken<T>): token is Token<T> {\n  return typeof token != \"symbol\";\n}\n\nexport function stringifyToken(token: MaybeToken): string {\n  if (isToken(token)) {\n    return `Token(${token.type.toString()})`;\n  } else {\n    return token.toString();\n  }\n}\n\nexport function getType(token: MaybeToken): symbol {\n  if (isToken(token)) {\n    return token.type;\n  } else {\n    return token;\n  }\n}\n","import { ContainerIoc } from \"./container\";\nimport { define } from \"./define\";\nimport { MaybeToken } from \"./token\";\n\nexport function createWire(container: ContainerIoc) {\n  return <Value, Target extends { [key in Prop]: Value }, Prop extends string>(\n    target: Target,\n    property: Prop,\n    token: MaybeToken<Value>,\n    ...args: symbol[]\n  ) => {\n    define(target, property, container, token, args);\n  };\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","export { ContainerIoc } from \"./container\";\nexport { createDecorator } from \"./decorator\";\nexport { createWire } from \"./wire\";\nexport { createResolve } from \"./resolve\";\nexport { NOCACHE, NOPLUGINS } from \"./symbol\";\nexport { token } from \"./token\";\n"],"names":[],"sourceRoot":""}